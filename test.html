<html>
<head>
	<title>Page Title</title>
	<style>
		.points{
			fill:steelblue;
		}
        .newpoints{
            fill: red;
        }
		polyline, .ray{
			fill:none;
			stroke-width:3;
			stroke:red;
			stroke-opacity:0.5;
		}
		.sweepline{
			stroke:blue;
		}
	</style>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>

<script>

var width=1800, height=1000,points;
function getRandomPoints(low, high){
	var mX=50, mY=50;//margin;
	return d3.range(low, high).map(function(d){ 
		return {i:d, x:mX+Math.round(Math.random()*(width-2*mX)), y:mY+Math.round(Math.random()*(height-2*mY))};
		});
}

function initialize(){	
	points=getRandomPoints(0, 15);
	console.log(points);
    
    d3.select("svg").remove(); //删除前一次的svg
	d3.select("body").append("svg").attr("width",width).attr("height",height);
    // d3.select("svg").append("line").attr("class","sweepline");
    // d3.select("svg").append("polyline");
	// d3.select("svg").append("line").attr("class","ray");
	
	d3.select("svg").selectAll(".points").data(points).enter().append("circle").attr("class","points")
		.attr("cx",function(d){ return d.x}).attr("cy",function(d){ return d.y})
		.style("r", 6);
        
    document.getElementById("next_btn").removeAttribute("disabled");
    // getBoundary();
}

function nextStep() {
    let current_nums = points.length;  //当前节点数
    let append_nums = Math.ceil(Math.min(Math.random() * current_nums * 0.2, 10000));  //随机添加的节点数
    console.log(append_nums)
    let new_points = getRandomPoints(current_nums, current_nums+append_nums) 
    points = points.concat(new_points)    //添加节点
    console.log(points)
    //画点
    d3.select("svg").selectAll(".points").style("fill", "steelblue").data(points).enter().append("circle").attr("class","points")
        .attr("cx",function(d){ return d.x}).attr("cy",function(d){ return d.y})
        .style("fill","red")
        .transition().transition(200)
        .styleTween("r", function() {
            return d3.interpolateNumber(0, 6);
        }).delay(450);
    //画线
    // d3.select("svg").selectAll("line").style("stroke", "steelblue");
    d3.select("svg").selectAll("line").remove();
    new_points.forEach(function(d) {
        let source = Math.floor(Math.random() * current_nums);
        d3.select("svg").append("line").style("stroke", "yellow")
        .attr("x1", points[source].x).attr("y1", points[source].y)
        .attr("x2", d.x).attr("y2", d.y)
        .style("stroke-dasharray", "2000, 2000")
        .transition().duration(1000)
        .styleTween("stroke-dashoffset", function() {
           return d3.interpolateNumber(2000, 0);
       });
    });

    console.log(document.getElementById("auto").checked);
    if (document.getElementById("auto").checked) {
        if (points.length < 10000) setTimeout(function(){nextStep()}, 1000);
    }
}

//initialize();
</script>
    <button onclick="initialize()">初始化</button>
    <button id="next_btn" onclick="nextStep()">下一轮</button>
    <input type="checkbox" id="auto">自动</input></br>
</body>
</html>